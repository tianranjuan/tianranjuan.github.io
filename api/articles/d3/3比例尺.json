{"title":"d3入门「三」：比例尺","uid":"232b42d69dd976bd6905d7c3b08f3b90","slug":"d3/3比例尺","date":"2025-09-28T07:38:44.886Z","updated":"2025-09-28T11:27:14.899Z","comments":true,"path":"api/articles/d3/3比例尺.json","keywords":null,"cover":"https://cdn.stocksnap.io/img-thumbs/280h/PQQREB6ZCV.jpg","content":"<h2 id=\"比例尺\"><a href=\"#比例尺\" class=\"headerlink\" title=\"比例尺\"></a>比例尺</h2><p>比例尺在可视化开发中有非常多的应用，比如：一段时间映射到时间轴、一段比例映射到一个宽度、将一个范围以对数方式映射到界面中等，本小节简单介绍一下项目中常用的几种比例尺和应用场景。</p>\n<p>定义一个比例尺，返回一个函数，支持设置比例尺的 <code>定义域(domain)</code> 与 <code>值域(range)</code>。</p>\n<p>比例尺的本质是一个函数，经常结合 <code>d3.max</code> 等函数使用。</p>\n<h2 id=\"定义域与值域\"><a href=\"#定义域与值域\" class=\"headerlink\" title=\"定义域与值域\"></a>定义域与值域</h2><p><strong>定义域</strong></p>\n<p>定义域是指：需要可视化的数据的定义范围，比如可视化数据是考试分数，那么定义域就是 <code>0~100</code>。</p>\n<p><strong>值域</strong></p>\n<p>值域是指：定义域需要投影到的具体数值范围，在可视化中指投影到屏幕上的像素范围，比如把定义域中的 <code>0~100</code> 的分数投影到屏幕上 <code>20~100</code> 的像素区间上。</p>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLinear</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">domain</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">]).</span><span style=\"color: #61AFEF\">range</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">20</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">]);</span></span></code></pre></div><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>NOTE</strong></p>\n<p>定义域与值域可以是全部连续的，也可以是全部离散的，也可以离散、连续搭配使用，具体定义根据不同的比例尺而已。</p></blockquote>\n<h3 id=\"scaleLinear-线性比例尺\"><a href=\"#scaleLinear-线性比例尺\" class=\"headerlink\" title=\"scaleLinear (线性比例尺)\"></a>scaleLinear (线性比例尺)</h3><p>线性比例尺包含两个部分：</p>\n<ul>\n<li><strong>domain (输入域)</strong> 用来表示待映射的数值范围</li>\n<li><strong>range (映射范围)</strong> 输入域经过映射后得到的输出范围，一般是绘图区域的像素或颜色等</li>\n</ul>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 旧版使用方法</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">scale</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLinear</span><span style=\"color: #ABB2BF\">().</span><span style=\"color: #61AFEF\">range</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #D19A66\">500</span><span style=\"color: #ABB2BF\">]).</span><span style=\"color: #61AFEF\">domain</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">,</span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">console</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">log</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #61AFEF\">scale</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">));   </span><span style=\"color: #7F848E; font-style: italic\">// 输出 0</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">console</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">log</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #61AFEF\">scale</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">50</span><span style=\"color: #ABB2BF\">));  </span><span style=\"color: #7F848E; font-style: italic\">// 输出 250</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">console</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">log</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #61AFEF\">scale</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">)); </span><span style=\"color: #7F848E; font-style: italic\">// 输出 500</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 新版使用方法</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLinear</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">10</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">130</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">960</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">x</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">20</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// 80</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">x</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">50</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// 320</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #7F848E; font-style: italic\">// 数值映射到颜色</span></span>\n<span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">color</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLinear</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">10</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #98C379\">\"brown\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"steelblue\"</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">20</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"rgb(154, 52, 57)\"</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">50</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"rgb(123, 81, 103)\"</span></span></code></pre></div><p>目前实际的开发中，映射到颜色是比较少的，一般是应用在数值间的映射，一般有这么几种应用场景：</p>\n<p>1、自定义图表时，X 轴、 Y 轴的映射：</p>\n<p>这个是很标准的用法，比如把数轴的数值范围[0<del>1]映射到页面像素上{width:0</del>100}上。</p>\n<p>2、映射到时间轴：</p>\n<p>这种场景其实正常应该使用 <strong>scaleTime</strong> 比例尺实现，但是有时候使用线性比例尺也可以实现（时间操作太频繁，转换太麻烦的时候可以使用线性比例尺简化开发）。</p>\n<p>具体实现思路是：</p>\n<ul>\n<li>先把开始结束时间的范围转换成时间戳 </li>\n<li>计算两个时间间的毫秒差距（根据需要的单位计算即可，比如秒级、分钟级、小时级等）</li>\n<li>把开始时间当做输入域的 0，时间差当做输入域的最大值</li>\n<li>设置映射范围</li>\n<li>转换数值</li>\n</ul>\n<p><img src=\"/image/d3/%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E4%BD%BF%E7%94%A8%E7%BA%BF%E6%80%A7%E6%AF%94%E4%BE%8B%E5%B0%BA%E7%9A%84%E5%AE%9E%E7%8E%B0.png\" alt=\"时间类型数据使用线性比例尺的实现\"></p>\n<p>3、A 数据范围映射到 B 数据范围：</p>\n<p>这种情况相对比较少，但是偶尔也是有的</p>\n<ul>\n<li>场景一：比如外部系统的系统使用 <code>0~100</code> 的数据，但是该数据并没有统一的规范，在本系统中使用 <code>300~500</code> 区间，此时就可以使用线性比例尺进行映射</li>\n<li>场景二：需要实现一个小地图系统，此时需要把大画布中的横纵坐标转换到小地图中，但是两个的宽高并不一样，此时使用线性比例尺可以高效且完美的转换</li>\n</ul>\n<p><img src=\"/image/d3/%E5%9D%90%E6%A0%87%E7%B3%BB%E9%97%B4%E7%9A%84%E7%8E%B0%E8%A1%8C%E6%98%A0%E5%B0%84.png\" alt=\"坐标系间的现行映射\"></p>\n<p><strong>invert(还原映射)</strong></p>\n<p>可以映射过去就可以映射回来，使用 invert 方法可以把输出的值还原会输入范围</p>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLinear</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">10</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">130</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">960</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">invert</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">80</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// 20</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">invert</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">320</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// 50</span></span></code></pre></div><h3 id=\"带比例尺\"><a href=\"#带比例尺\" class=\"headerlink\" title=\"带比例尺\"></a>带比例尺</h3><p>用法类似线性比例尺, 场景使用场景在柱状图上，每个柱子或每组柱子可以占用一个带的宽度。</p>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleBand</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #98C379\">\"1\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"2\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"3\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"4\"</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">100</span><span style=\"color: #ABB2BF\">]);</span></span></code></pre></div><p><img src=\"/image/d3/%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BA.png\" alt=\"带比例尺\"></p>\n<p><strong>获取宽度</strong></p>\n<p>带有两种方式获取宽度，这两种方式略有不同：</p>\n<ul>\n<li>BandWidth: 获取带本身的宽度大小</li>\n<li>Step：获取当前带起始位置到下一个带的起始位置的宽度大小</li>\n</ul>\n<p><img src=\"/image/d3/%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BA%E5%AE%BD%E5%BA%A6.png\" alt=\"带比例尺宽度\"></p>\n<p><strong>align</strong></p>\n<p>带比例尺与线性比例尺的使用多了一些间距的配置：</p>\n<ul>\n<li>内间距：每个带之间的间距</li>\n<li>外间距：所有带与坐标轴两端的间距</li>\n<li>Align：0~1 的数字，表示外间距如何分配</li>\n</ul>\n<div class=\"language-javascript\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">javascript</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">align</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0.5</span><span style=\"color: #ABB2BF\">)</span></span></code></pre></div><p>当 <code>align = 0</code> 时所有的外间距都会分配给带的右侧，带的位置在坐标轴上左对齐。</p>\n<p><img src=\"/image/d3/%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BAalign0.png\" alt=\"带比例尺align0\"></p>\n<p>当 <code>align = 0.5</code> 时所有的外间距都会均匀的分配给带的两侧，带的位置在坐标轴上居中。</p>\n<p><img src=\"/image/d3/%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BAalign0.png\" alt=\"带比例尺align0\"></p>\n<p>当 <code>align = 1</code> 时所有的外间距都会均匀的分配给带的左侧，带的位置在坐标轴上右对齐。</p>\n<p><img src=\"/image/d3/%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BAalign1.png\" alt=\"带比例尺align1\"></p>\n<h3 id=\"时间比例尺\"><a href=\"#时间比例尺\" class=\"headerlink\" title=\"时间比例尺\"></a>时间比例尺</h3><p>与线性比例尺使用方法一致，区别只在于输入域为时间类型数据。</p>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleTime</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #C678DD\">new</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">Date</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">2000</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">), </span><span style=\"color: #C678DD\">new</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">Date</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">2000</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">2</span><span style=\"color: #ABB2BF\">)], [</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">960</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">x</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">new</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">Date</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">2000</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">5</span><span style=\"color: #ABB2BF\">)); </span><span style=\"color: #7F848E; font-style: italic\">// 200</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">x</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #C678DD\">new</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #61AFEF\">Date</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">2000</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">16</span><span style=\"color: #ABB2BF\">)); </span><span style=\"color: #7F848E; font-style: italic\">// 640</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">invert</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">200</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// Sat Jan 01 2000 05:00:00 GMT-0800 (PST)</span></span>\n<span class=\"line\"><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">invert</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">640</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// Sat Jan 01 2000 16:00:00 GMT-0800 (PST)</span></span></code></pre></div><h3 id=\"对数比例尺\"><a href=\"#对数比例尺\" class=\"headerlink\" title=\"对数比例尺\"></a>对数比例尺</h3><p>与线性比例尺使用方法一致，主要的区别在于使用场景。</p>\n<p>有一些时候映射区域过大，操作非常的不方便，比如：以 1 px 映射 1 米作为规则进行映射，此时输入范围为 0~100000 m 此时界面几乎无法操作，数据无法展示全貌，这种情况下可以使用对数比例尺，进行压缩。</p>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">x</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleLog</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">10</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">960</span><span style=\"color: #ABB2BF\">]);</span></span></code></pre></div><p><img src=\"/image/d3/%E5%AF%B9%E6%95%B0%E6%97%B6%E9%97%B4%E8%BD%B4.png\" alt=\"对数时间轴\"></p>\n<p>上面为对数数轴，可以看出越往后相同的数据宽度表示的数值范围越大。</p>\n<h3 id=\"阈值比例尺\"><a href=\"#阈值比例尺\" class=\"headerlink\" title=\"阈值比例尺\"></a>阈值比例尺</h3><p>与线性比例尺使用方法一致，主要的区别在于当达到某一个阈值后得到的值都是固定的。</p>\n<div class=\"language-js\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">js</span><pre class=\"shiki one-dark-pro\" style=\"background-color: #282c34\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #C678DD\">const</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">color</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #56B6C2\">=</span><span style=\"color: #ABB2BF\"> </span><span style=\"color: #E5C07B\">d3</span><span style=\"color: #ABB2BF\">.</span><span style=\"color: #61AFEF\">scaleThreshold</span><span style=\"color: #ABB2BF\">([</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">], [</span><span style=\"color: #98C379\">\"red\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"white\"</span><span style=\"color: #ABB2BF\">, </span><span style=\"color: #98C379\">\"green\"</span><span style=\"color: #ABB2BF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #56B6C2\">-</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"red\"</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"white\"</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">0.5</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"white\"</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">1</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"green\"</span></span>\n<span class=\"line\"><span style=\"color: #61AFEF\">color</span><span style=\"color: #ABB2BF\">(</span><span style=\"color: #D19A66\">1000</span><span style=\"color: #ABB2BF\">); </span><span style=\"color: #7F848E; font-style: italic\">// \"green\"</span></span></code></pre></div><p>这种比例尺比较适合在<strong>等高线图颜色</strong>、<strong>热力图颜色</strong>、<strong>变化趋势等级颜色</strong>、<strong>警戒线等级颜色</strong>等场景。</p>\n","text":"比例尺比例尺在可视化开发中有非常多的应用，比如：一段时间映射到时间轴、一段比例映射到一个宽度、将一个范围以对数方式映射到界面中等，本小节简单介绍一下项目中常用的...","permalink":"/post/d3/3比例尺","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"d3","slug":"d3","count":5,"path":"api/categories/d3.json"}],"tags":[{"name":"d3","slug":"d3","count":5,"path":"api/tags/d3.json"},{"name":"数据可视化","slug":"数据可视化","count":5,"path":"api/tags/数据可视化.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">比例尺</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9A%E4%B9%89%E5%9F%9F%E4%B8%8E%E5%80%BC%E5%9F%9F\"><span class=\"toc-text\">定义域与值域</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#scaleLinear-%E7%BA%BF%E6%80%A7%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">scaleLinear (线性比例尺)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B8%A6%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">带比例尺</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%97%B6%E9%97%B4%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">时间比例尺</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AF%B9%E6%95%B0%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">对数比例尺</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%98%88%E5%80%BC%E6%AF%94%E4%BE%8B%E5%B0%BA\"><span class=\"toc-text\">阈值比例尺</span></a></li></ol></li></ol>","author":{"name":"天然卷打工战士","slug":"blog-author","avatar":"https://pic-blog-1255296193.cos.ap-beijing.myqcloud.com/touxiang.jpg","link":"/","description":"未看此花时， <br> 此花与汝同归于寂； <br> 来看此花时， <br> 此花颜色一时明白过来。","socials":{"github":"https://github.com/tianranjuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"d3入门「四」：实现交互","uid":"0541b8b181491af42712df40ab16bcdd","slug":"d3/4实现交互","date":"2025-09-28T11:13:23.519Z","updated":"2025-09-28T11:37:32.565Z","comments":true,"path":"api/articles/d3/4实现交互.json","keywords":null,"cover":"https://cdn.stocksnap.io/img-thumbs/280h/ETRVZT98ZC.jpg","text":"实现交互Zoom 缩放交互行为 (缩放、平移)D3 提供了一种灵活的抽象，提供了缩放、平移的能力，可以处理各种各样的输入模式和浏览器异常。缩放行为与 DOM 无...","permalink":"/post/d3/4实现交互","photos":[],"count_time":{"symbolsCount":"2.3k","symbolsTime":"2 mins."},"categories":[{"name":"d3","slug":"d3","count":5,"path":"api/categories/d3.json"}],"tags":[{"name":"d3","slug":"d3","count":5,"path":"api/tags/d3.json"},{"name":"数据可视化","slug":"数据可视化","count":5,"path":"api/tags/数据可视化.json"}],"author":{"name":"天然卷打工战士","slug":"blog-author","avatar":"https://pic-blog-1255296193.cos.ap-beijing.myqcloud.com/touxiang.jpg","link":"/","description":"未看此花时， <br> 此花与汝同归于寂； <br> 来看此花时， <br> 此花颜色一时明白过来。","socials":{"github":"https://github.com/tianranjuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"d3入门「一」：在项目中使用d3","uid":"65dc118887986eec94800b37afb1763d","slug":"d3/1为什么使用D3","date":"2025-09-28T07:01:07.521Z","updated":"2025-09-28T11:25:59.067Z","comments":true,"path":"api/articles/d3/1为什么使用D3.json","keywords":null,"cover":"https://cdn.stocksnap.io/img-thumbs/280h/succulent-plant_T57PJUYFWM.jpg","text":"为什么使用D3D3 的全称是 Data-Driven Document 即数据驱动文档，是一个基于数据操作 DOM 的 Javascript 库，也是现有最流行...","permalink":"/post/d3/1为什么使用D3","photos":[],"count_time":{"symbolsCount":"3.1k","symbolsTime":"3 mins."},"categories":[{"name":"d3","slug":"d3","count":5,"path":"api/categories/d3.json"}],"tags":[{"name":"d3","slug":"d3","count":5,"path":"api/tags/d3.json"},{"name":"数据可视化","slug":"数据可视化","count":5,"path":"api/tags/数据可视化.json"}],"author":{"name":"天然卷打工战士","slug":"blog-author","avatar":"https://pic-blog-1255296193.cos.ap-beijing.myqcloud.com/touxiang.jpg","link":"/","description":"未看此花时， <br> 此花与汝同归于寂； <br> 来看此花时， <br> 此花颜色一时明白过来。","socials":{"github":"https://github.com/tianranjuan","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}